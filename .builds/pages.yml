image: archlinux
packages:
  - python-poetry
  - nodejs
  - npm
  - rsync
  - imagemagick
sources:
  - https://git.sr.ht/~fmartingr/fmartingr.com
secrets:
  - f577557b-ed7b-4ce4-a103-d9c8e692c09b
  - 7902c1da-f243-4bb3-a397-dc1c98faa823
  - c82cd104-227b-4745-89ae-960b5f7c82ae
tasks:
  # https://todo.sr.ht/~sircmpwn/builds.sr.ht/170
  - check-branch: |
      cd fmartingr.com
      if [ "$(git rev-parse master)" != "$(git rev-parse HEAD)" ]; then \
          complete-build; \
      fi
  - prepare: |
      cd fmartingr.com
      python -V
      make setup
  - deploy: |
      cd fmartingr.com
      poetry run make deploy
